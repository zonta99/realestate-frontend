<!-- Mobile Navigation -->
<mat-toolbar class="mobile-toolbar" role="banner">
  <div class="brand-section" routerLink="/dashboard">
    <mat-icon class="brand-icon">home</mat-icon>
    <span class="brand-text">CRM</span>
  </div>

  <span class="flex-spacer"></span>

  <button
    mat-icon-button
    [matBadge]="3"
    matBadgeColor="accent"
    class="notification-btn"
    aria-label="Notifications">
    <mat-icon>notifications</mat-icon>
  </button>

  <button
    mat-icon-button
    [matMenuTriggerFor]="userMenu"
    class="user-btn"
    aria-label="User menu">
    <div class="user-avatar mobile">{{ userDisplayInfo().initials }}</div>
  </button>
</mat-toolbar>

<!-- Desktop Navigation -->
<mat-toolbar class="desktop-toolbar" role="banner">
  <div class="brand-section" routerLink="/dashboard" role="button" tabindex="0">
    <mat-icon class="brand-icon">home</mat-icon>
    <span class="brand-text">Real Estate CRM</span>
  </div>

  <nav class="desktop-nav" role="navigation" aria-label="Main navigation">
    @for (item of visibleNavItems(); track item.id) {
      <button
        mat-button
        [routerLink]="item.route"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: item.route === '/dashboard' }"
        class="nav-button">
        <mat-icon [matBadge]="item.badge" [matBadgeHidden]="!item.badge" matBadgeColor="accent">
          {{ item.icon }}
        </mat-icon>
        <span>{{ item.label }}</span>
      </button>
    }
  </nav>

  <span class="flex-spacer"></span>

  <div class="toolbar-actions">
    <button mat-icon-button [matBadge]="3" matBadgeColor="accent">
      <mat-icon>notifications</mat-icon>
    </button>

    <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
      <div class="user-avatar">{{ userDisplayInfo().initials }}</div>
      <mat-icon>arrow_drop_down</mat-icon>
    </button>
  </div>
</mat-toolbar>

<!-- Mobile Bottom Navigation -->
<nav class="mobile-bottom-nav" role="navigation" aria-label="Mobile bottom navigation">
  @for (item of mobileNavItems(); track item.id) {
    <button
      mat-button
      [routerLink]="item.route"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: item.route === '/dashboard' }"
      class="bottom-nav-item"
      [attr.aria-label]="item.label">
      <mat-icon
        [matBadge]="item.badge"
        [matBadgeHidden]="!item.badge"

        class="bottom-nav-icon">
        {{ item.icon }}
      </mat-icon>
      <span class="bottom-nav-label">{{ item.label }}</span>
    </button>
  }
</nav>

<!-- User Menu (Shared) -->
<mat-menu #userMenu="matMenu" class="user-menu">
  <div class="user-menu-header">
    <div class="user-avatar large">{{ userDisplayInfo().initials }}</div>
    <div class="user-details">
      <div class="user-name">{{ userDisplayInfo().fullName }}</div>
      <div class="user-email">{{ userDisplayInfo().email }}</div>
      <mat-chip class="role-chip" [class]="getRoleChipClass()">
        <mat-icon>{{ getRoleIcon() }}</mat-icon>
        {{ getPrimaryRole() }}
      </mat-chip>
    </div>
  </div>

  <mat-divider></mat-divider>

  <button mat-menu-item routerLink="/profile">
    <mat-icon>person</mat-icon>
    <span>Profile</span>
  </button>

  @if (hasSubordinates()) {
    <button mat-menu-item routerLink="/users/hierarchy">
      <mat-icon>account_tree</mat-icon>
      <span>My Team</span>
      <span class="team-count">({{ getSubordinateCount() }})</span>
    </button>
  }

  <button mat-menu-item>
    <mat-icon>settings</mat-icon>
    <span>Settings</span>
  </button>

  <button mat-menu-item>
    <mat-icon>help_outline</mat-icon>
    <span>Help & Support</span>
  </button>

  <mat-divider></mat-divider>

  <button mat-menu-item (click)="logout()" class="logout-button">
    <mat-icon>logout</mat-icon>
    <span>Sign Out</span>
  </button>
</mat-menu>
